<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pooxie Watch Discover</title>
  <style>
    body {
      margin: 0;
      background: linear-gradient(180deg, #0f0c29, #302b63, #24243e);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: white;
      overflow-x: hidden;
    }

    header {
      padding: 20px;
      text-align: center;
      font-size: 2em;
      background: rgba(0, 0, 0, 0.4);
      font-weight: bold;
    }

    .search-bar {
      text-align: center;
      margin: 20px;
    }

    .search-bar input {
      width: 60%;
      padding: 10px;
      border-radius: 10px;
      border: none;
      font-size: 16px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 20px;
      padding: 20px;
    }

    .card {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 0 20px rgba(255, 255, 255, 0.1);
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .card:hover {
      transform: scale(1.05);
      box-shadow: 0 0 30px rgba(255, 102, 204, 0.5);
    }

    .card img {
      width: 100%;
      aspect-ratio: 2 / 3;
      object-fit: cover;
    }

    .card-content {
      padding: 10px;
    }

    .card-content h3 {
      font-size: 1.1em;
      margin: 0;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .card-content p {
      font-size: 0.9em;
      color: #ccc;
      margin-top: 8px;
      max-height: 80px;
      overflow: hidden;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
    }

    .card-content button {
      margin-top: 10px;
      padding: 10px;
      border: none;
      border-radius: 10px;
      background-color: #ff66cc;
      color: white;
      cursor: pointer;
      font-weight: bold;
      width: 100%;
      transition: all 0.3s ease;
    }

    .card-content button:hover {
      background-color: #ff85d8;
    }

    /* Category tabs */
    .category-tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      padding: 0 20px;
      overflow-x: auto;
      scrollbar-width: none;
    }

    .category-tabs::-webkit-scrollbar {
      display: none;
    }

    .category-tab {
      padding: 8px 16px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 20px;
      cursor: pointer;
      white-space: nowrap;
      transition: all 0.3s ease;
    }

    .category-tab:hover, .category-tab.active {
      background: #ff66cc;
    }

    .category-section {
      margin: 30px 20px 10px;
    }

    .category-title {
      font-size: 1.5em;
      margin-bottom: 15px;
      padding-bottom: 5px;
      border-bottom: 2px solid #ff66cc;
      display: inline-block;
    }

    /* Detail Overlay */
    .detail-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      z-index: 1000;
      display: none;
      justify-content: center;
      align-items: center;
      backdrop-filter: blur(10px);
    }

    .detail-container {
      width: 80%;
      max-width: 800px;
      background: linear-gradient(135deg, #24243e, #302b63);
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 0 40px rgba(255, 102, 204, 0.3);
    }

    .detail-header {
      position: relative;
      height: 400px;
      background-size: cover;
      background-position: center;
    }

    .detail-header::before {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 150px;
      background: linear-gradient(to top, #24243e, transparent);
    }

    .detail-close {
      position: absolute;
      top: 20px;
      right: 20px;
      background: rgba(0, 0, 0, 0.7);
      border: none;
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      font-size: 1.5em;
      cursor: pointer;
      z-index: 2;
    }

    .detail-meta {
      position: absolute;
      bottom: 20px;
      left: 20px;
      z-index: 2;
      display: flex;
      gap: 15px;
      align-items: center;
    }

    .detail-meta-item {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 0.9em;
    }

    .detail-meta-rating {
      background: rgba(255, 255, 255, 0.2);
      padding: 3px 8px;
      border-radius: 4px;
      font-weight: bold;
    }

    .detail-body {
      padding: 30px;
    }

    .detail-title {
      font-size: 2em;
      margin-bottom: 10px;
    }

    .detail-buttons {
      display: flex;
      gap: 15px;
      margin: 20px 0;
    }

    .detail-btn {
      padding: 10px 20px;
      border-radius: 5px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .detail-btn-play {
      background: #ff66cc;
      color: white;
      border: none;
    }

    .detail-btn-play:hover {
      background: #ff85d8;
    }

    .detail-btn-secondary {
      background: rgba(255, 255, 255, 0.1);
      color: white;
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .detail-btn-secondary:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .detail-overview {
      line-height: 1.6;
      margin-bottom: 20px;
    }

    .detail-info {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }

    .detail-info-item h4 {
      margin: 0 0 5px 0;
      color: #ff66cc;
      font-size: 0.9em;
    }

    .detail-info-item p {
      margin: 0;
      font-size: 0.9em;
    }

    /* Loading indicator */
    .loading {
      text-align: center;
      padding: 20px;
      font-size: 1.2em;
      color: #ff66cc;
      display: none;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
      .detail-container {
        width: 95%;
      }
      
      .detail-header {
        height: 300px;
      }
      
      .detail-body {
        padding: 20px;
      }
    }
  </style>
</head>
<body>
  <header>üé¨ Discovery</header>
  <div class="search-bar">
    <input type="text" id="searchInput" placeholder="Search movies or TV shows...">
  </div>
  <div class="category-tabs" id="categoryTabs">
    <div class="category-tab active" data-category="popular">Popular</div>
    <div class="category-tab" data-category="trending">Trending</div>
    <div class="category-tab" data-category="top_rated">Top Rated</div>
    <div class="category-tab" data-category="action">Action</div>
    <div class="category-tab" data-category="comedy">Comedy</div>
    <div class="category-tab" data-category="sci_fi">Sci-Fi</div>
  </div>
  <div class="category-section">
    <div class="category-title" id="currentCategory">Popular</div>
    <div class="grid" id="results"></div>
    <div class="loading" id="loadingIndicator">Loading more content...</div>
  </div>

  <!-- Detail Overlay -->
  <div class="detail-overlay" id="detailOverlay">
    <div class="detail-container">
      <div class="detail-header" id="detailHeader">
        <button class="detail-close" id="detailClose">&times;</button>
        <div class="detail-meta">
          <div class="detail-meta-item">
            <span class="detail-meta-rating" id="detailRating">PG-13</span>
          </div>
          <div class="detail-meta-item">
            <span id="detailYear">2023</span>
          </div>
          <div class="detail-meta-item">
            <span id="detailRuntime">2h 18m</span>
          </div>
          <div class="detail-meta-item">
            <span id="detailScore">‚≠ê 8.4/10</span>
          </div>
        </div>
      </div>
      <div class="detail-body">
        <h2 class="detail-title" id="detailTitle">Movie Title</h2>
        <div class="detail-buttons">
          <button class="detail-btn detail-btn-play" id="detailPlay">‚ñ∂ Play</button>
          <button class="detail-btn detail-btn-secondary">+ My List</button>
        </div>
        <p class="detail-overview" id="detailOverview">Overview text goes here...</p>
        <div class="detail-info">
          <div class="detail-info-item">
            <h4>Cast</h4>
            <p id="detailCast">Actor 1, Actor 2, Actor 3</p>
          </div>
          <div class="detail-info-item">
            <h4>Genre</h4>
            <p id="detailGenre">Action, Adventure</p>
          </div>
          <div class="detail-info-item">
            <h4>Director</h4>
            <p id="detailDirector">Director Name</p>
          </div>
          <div class="detail-info-item">
            <h4>Release Date</h4>
            <p id="detailRelease">January 1, 2023</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const API_KEY = '95266f5bb551bf1ae4078c918c7185e4';
    const BASE_URL = 'https://api.themoviedb.org/3';
    const IMG_BASE = 'https://image.tmdb.org/t/p/';

    // DOM Elements
    const resultsContainer = document.getElementById('results');
    const searchInput = document.getElementById('searchInput');
    const categoryTabs = document.getElementById('categoryTabs');
    const currentCategoryTitle = document.getElementById('currentCategory');
    const loadingIndicator = document.getElementById('loadingIndicator');
    const detailOverlay = document.getElementById('detailOverlay');
    const detailClose = document.getElementById('detailClose');
    const detailHeader = document.getElementById('detailHeader');
    const detailTitle = document.getElementById('detailTitle');
    const detailRating = document.getElementById('detailRating');
    const detailYear = document.getElementById('detailYear');
    const detailRuntime = document.getElementById('detailRuntime');
    const detailScore = document.getElementById('detailScore');
    const detailOverview = document.getElementById('detailOverview');
    const detailCast = document.getElementById('detailCast');
    const detailGenre = document.getElementById('detailGenre');
    const detailDirector = document.getElementById('detailDirector');
    const detailRelease = document.getElementById('detailRelease');
    const detailPlay = document.getElementById('detailPlay');

    // State
    let currentMedia = {};
    let currentCategory = 'popular';
    let currentPage = 1;
    let isLoading = false;
    let hasMoreContent = true;
    let currentSearchQuery = '';

    // Genre IDs mapping
    const GENRE_IDS = {
      action: 28,
      comedy: 35,
      sci_fi: 878
    };

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      fetchContent(currentCategory);
      setupInfiniteScroll();
    });

    // Event Listeners
    categoryTabs.addEventListener('click', handleCategoryClick);
    searchInput.addEventListener('input', handleSearch);
    detailClose.addEventListener('click', () => detailOverlay.style.display = 'none');
    detailPlay.addEventListener('click', handlePlayClick);

    // Setup infinite scroll
    function setupInfiniteScroll() {
      window.addEventListener('scroll', () => {
        if (isLoading || !hasMoreContent) return;
        
        const { scrollTop, scrollHeight, clientHeight } = document.documentElement;
        if (scrollTop + clientHeight >= scrollHeight - 500) {
          loadMoreContent();
        }
      });
    }

    async function loadMoreContent() {
      if (isLoading) return;
      
      isLoading = true;
      loadingIndicator.style.display = 'block';
      currentPage++;
      
      try {
        if (currentSearchQuery) {
          await search(currentSearchQuery, currentPage);
        } else {
          await fetchContent(currentCategory, currentPage);
        }
      } finally {
        isLoading = false;
        loadingIndicator.style.display = 'none';
      }
    }

    async function fetchContent(category, page = 1) {
      currentCategory = category;
      currentPage = page;
      
      let url;
      switch(category) {
        case 'popular':
          url = `${BASE_URL}/movie/popular?api_key=${API_KEY}&page=${page}`;
          break;
        case 'trending':
          url = `${BASE_URL}/trending/movie/day?api_key=${API_KEY}&page=${page}`;
          break;
        case 'top_rated':
          url = `${BASE_URL}/movie/top_rated?api_key=${API_KEY}&page=${page}`;
          break;
        default:
          if (GENRE_IDS[category]) {
            url = `${BASE_URL}/discover/movie?api_key=${API_KEY}&with_genres=${GENRE_IDS[category]}&page=${page}`;
          }
      }

      try {
        const response = await fetch(url);
        const data = await response.json();
        
        if (page === 1) {
          resultsContainer.innerHTML = '';
          hasMoreContent = true;
        }
        
        displayResults(data.results);
        
        if (page >= data.total_pages) {
          hasMoreContent = false;
        }
      } catch (error) {
        console.error('Error fetching content:', error);
      }
    }

    function displayResults(items) {
      if (!items || items.length === 0) {
        if (currentPage === 1) {
          resultsContainer.innerHTML = '<p style="grid-column: 1/-1; text-align: center;">No results found</p>';
        }
        return;
      }

      items.forEach(item => {
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <img src="${item.poster_path ? IMG_BASE + 'w500' + item.poster_path : 'https://via.placeholder.com/500x750?text=No+Image'}" alt="${item.title}" loading="lazy">
          <div class="card-content">
            <h3>${item.title}</h3>
            <p>${item.overview || "No description available."}</p>
          </div>
        `;
        card.addEventListener('click', () => showDetails(item));
        resultsContainer.appendChild(card);
      });
    }

    async function showDetails(item) {
      try {
        // Show loading state
        detailHeader.style.backgroundImage = 'linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3))';
        detailTitle.textContent = 'Loading...';
        detailOverview.textContent = '';
        detailOverlay.style.display = 'flex';

        // Fetch additional details
        const [details, credits] = await Promise.all([
          fetch(`${BASE_URL}/movie/${item.id}?api_key=${API_KEY}`).then(r => r.json()),
          fetch(`${BASE_URL}/movie/${item.id}/credits?api_key=${API_KEY}`).then(r => r.json())
        ]);

        // Set background image
        if (details.backdrop_path) {
          detailHeader.style.backgroundImage = `linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.3)), url(${IMG_BASE}original${details.backdrop_path})`;
        }

        // Set text content
        detailTitle.textContent = details.title;
        
        // Get US certification or default to NR
        const releaseDates = await fetch(`${BASE_URL}/movie/${item.id}/release_dates?api_key=${API_KEY}`).then(r => r.json());
        const usCert = releaseDates.results.find(r => r.iso_3166_1 === 'US')?.release_dates[0]?.certification;
        detailRating.textContent = usCert || 'NR';
        
        detailYear.textContent = new Date(details.release_date).getFullYear();
        
        // Format runtime
        if (details.runtime) {
          const hours = Math.floor(details.runtime / 60);
          const mins = details.runtime % 60;
          detailRuntime.textContent = `${hours}h ${mins}m`;
        } else {
          detailRuntime.textContent = 'N/A';
        }
        
        detailScore.textContent = `‚≠ê ${details.vote_average?.toFixed(1) || 'N/A'}/10`;
        detailOverview.textContent = details.overview || 'No overview available.';
        
        // Get top 3 cast members
        const cast = credits.cast.slice(0, 3).map(p => p.name).join(', ');
        detailCast.textContent = cast || 'N/A';
        
        // Get genres
        const genres = details.genres?.map(g => g.name).join(', ');
        detailGenre.textContent = genres || 'N/A';
        
        // Get director
        const director = credits.crew?.find(p => p.job === 'Director')?.name;
        detailDirector.textContent = director || 'N/A';
        
        // Format release date
        if (details.release_date) {
          detailRelease.textContent = new Date(details.release_date).toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'long',
            day: 'numeric'
          });
        } else {
          detailRelease.textContent = 'N/A';
        }
        
        // Store current media for play button
        currentMedia = {
          id: details.id,
          type: 'movie'
        };
        
      } catch (error) {
        console.error('Error loading details:', error);
        detailTitle.textContent = 'Error loading details';
        detailOverview.textContent = 'Please try again later.';
      }
    }

    function handlePlayClick() {
      window.location.href = `watch.html?type=${currentMedia.type}&id=${currentMedia.id}`;
    }

    function handleCategoryClick(e) {
      if (e.target.classList.contains('category-tab')) {
        document.querySelectorAll('.category-tab').forEach(tab => tab.classList.remove('active'));
        e.target.classList.add('active');
        currentCategory = e.target.dataset.category;
        currentCategoryTitle.textContent = e.target.textContent;
        currentPage = 1;
        fetchContent(currentCategory);
      }
    }

    function handleSearch() {
      const query = searchInput.value.trim();
      currentSearchQuery = query;
      
      if (query.length > 2) {
        currentPage = 1;
        search(query);
      } else if (query.length === 0) {
        currentSearchQuery = '';
        currentPage = 1;
        fetchContent(currentCategory);
      }
    }

    async function search(query, page = 1) {
      try {
        const response = await fetch(`${BASE_URL}/search/movie?api_key=${API_KEY}&query=${encodeURIComponent(query)}&page=${page}`);
        const data = await response.json();
        
        if (page === 1) {
          resultsContainer.innerHTML = '';
          hasMoreContent = true;
        }
        
        displayResults(data.results);
        
        if (page >= data.total_pages) {
          hasMoreContent = false;
        }
      } catch (error) {
        console.error('Error searching:', error);
      }
    }
  </script>
</body>
</html>
